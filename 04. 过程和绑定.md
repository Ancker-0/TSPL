# 过程和变量绑定

过程和变量绑定是Scheme程序的基本构建快。本章描述了一小部分的语法形式，它们的主要目的是创建过程和操作变量绑定。它从两个最基本的Scheme程序构建块开始:变量引用和`lambda`表达式，以及变量绑定和赋值的描述，如`define`、`letrec`、`let`值和`set!`。

你能在第五章找到其他各种形式的变量绑定或赋值的语法，因为它们的其主要目的不是绑定或赋值，如`let`。

## 4.1 变量引用

语法: 变量  
返回: 变量的值

如果存在标识符绑定了一个可视变量，那么它在程序中作为表达式出现时都将视为变量，例如，标识符出现在由`define`、`lambda`、`let`或其他变量绑定结构的作用域中。

```scheme
list => #\<procedure>
(define x 'a)
(let ([x 'b])
  (list x x)) => (b b)
(let ([let 'let]) let) => let
```

如果标识符出现在`library`形式或者顶级程序中时，没有绑定为变量、关键字、`record`名或其他实体，那么会造成语法冲突。  
因为一个库、顶级程序、`lambda`或者本地内容的定义域是一个整体，所以只要一个引用在定义完成前不立即求值，那么变量的定义可以出现在引用第一次出现之后。因此，举个例子，下面对`f`的定义中，引用g是允许的。

```scheme
(define f
  (lambda (x)
    (g x)))
(define g
  (lambda (x)
    (+ x x)))
```

但是，下面的定义`q`中`g`的引用是错误的。

```scheme
(define q (g 3))
(define g
  (lambda (x)
    (+ x x)))
```

## 4.2 Lambda

语法: (lambda formals body1 body2)
返回: 一个过程
库: (rnrs base)，(rnrs)

lambda语法形式用于创建过程。任何创建过程或建立局部变量绑定的操作最终都是依照`lambda`或`case-lambda`定义的。

在`formals`中的变量是过程的形式化参数，而子序列`body1`、`body2`……是它的主体。

主体可以从一系列定义开始，在这种情况下，由定义创建的绑定是属于主体本地的。如果定义存在，则关键字绑定将在在主体展开时使用和丢弃，主体将被展开成由变量定义和其余表达式组成的 `letrec*`表达式，如第八章所述。`lambda`描述的其余部分假定了这个转换已经发生(如果需要的话)，因此主体是一系列没有定义的表达式。

在创建过程时，除形式参数外，在主体中自由出现的所有变量的绑定将与过程一起保留。随后，每当将过程应用到一个实际参数序列上时，将形式参数绑定到世纪参数上，恢复保留的绑定，并计算主体。

应用时，由`formals`定义的形式参数与实际参数绑定如下:

* 如果`formals`是一个标准变量列表，例如`(x y z)`，则每个变量都绑定到相应的实际参数。如果提供的实际参数太少或太多，就会引发条件类型`&assertion`的异常。
* 如果`formals`是单个变量(不在列表中)，例如`z`，它就绑定到实际参数的列表。
* 如果`formals`是一个以变量结尾的不标准变量列表，例如`(x y)`，除最后一个变量外，每个变量都绑定相应的实际参数。最后一个变量绑定到剩下的实际参数列表。如果提供的实际参数太少，则会引发条件类型`&assertion`的异常。

计算主体时，主体中的表达式按顺序计算，过程返回最后一个表达式的值。

通常情况下，过程没有一个可打印的输出形式。`Scheme`系统以不同方式打印程序;本书使用符号#\<procedure>。

```scheme
(lambda (x) (+ x 3)) => #\<procedure>
((lambda (x) (+ x 3)) 7) => 10
((lambda (x y) (* x (+ x y))) 7 13) => 140
((lambda (f x) (f x x)) + 11) => 22
((lambda () (+ 3 4))) => 7

((lambda (x . y) (list x y))
  28 37) => (28 (37))
((lambda (x . y)(list x y))
  28 37 47 28) => (28 (37 47 28))
((lambda (x y . z) (list x y z))
  1 2 3 4) => (1 2 (3 4))
((lambda x x) 7 13) => (7 13)
```
